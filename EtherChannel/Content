- Etherchannel
- 종단 호스트는 네트워크로 트래픽을 지속적으로 보내지 않는다.
- 캠퍼스 LAN에 얼마나 많은 초과 가입이 있어야 하는지에 대한 통상적인 원칙은 
- 액세스층과 분배층의 비율로 20:1 정도다
- 즉, 액세스층에서 1Gbps 네트워크 카드로 연결된 20대의 pc가 있으면 트래픽을 지원하기 위해서는
- 분배층에는 한 개의 1G 업링크가 필요하다.
- 분배층에서 코어층 링크의 권장 비율은 4:1이다
- 스위치에는 액세스 포트의 대역폭보다 넓은 대역폭을 가진 전용 업링크 포트가 있는 경우가 많다.
- 예를 들어 한 쌍의 10Gbps 업링크가 있는 48포트 1Gbps 스위치는 
- 스위치에 1Gbps 클라이언트 48개가 연결되어 있는 경우 가능한 총 대역폭은 48Gbps다
- 10Gbps 업링크가 두 개 있으면 업링크 링크에 약 20Gbps가 있으므로
- 가입 비율은 2.4:1이 된다.
- 두 개의 업링크를 연결하려고 할 때 스패닝 트리 문제가 생긴다
- 스패닝 트리는 다중화는 제공하지만 부하 분산은 제공하지 않기 때문이다.
- 스패닝 트리 루프를 피하기 위해 항상 최상의 경로 한 개를 선택합니다.
- 스위치에 동일한 비용 경로가 여러 개 있는 경우 루트 브리지로 전환하지 않는다
- 가장 낮은 포트 ID를 가진 포트 중 하나를 선택한다. 모든 스위치에 걸처 부하 분산을 하지 않는다.

- 물리적으로 연결된 모든 사용 가능한 업링크 대역폭을 얻지 못하는 문제가 생긴다.
- 그 문제에 대한 해결책은 EtherChnannel
- 여러 물리적 인터페이스를 단일 논리적 인터페이스로 그룹화하고 스패닝 트리는 EtherChannel을 
- 단일 인터페이스로 인식하여 포트를 막지 않게 된다.
- 트래픽은 EtherCnannel에 있는 모든 링크에서 부하 분산하게 된다.
- 다중화도 제공한다. 인터페이스가 다운되면 트래픽은 나머지 링크로 전송하게 된다.

- Port Channel
- LAG [ Link Aggregation ]
- Link bundle

- NIC Teaming 으로 서버에서도 동일한 작업을 수행할 수 있다.
- 여러 물리적 네트워크 카드를 단일 논리적 인터페이스로 묶을 수 있다.
- 부하 분산과 다중성을 얻을 수 있다.

- Bonding
- NIC balancing
- Link aggregation

- 부하 분산
- 패킷은 포트 채널의 모든 인터페이스에서 라운드 로빈으로 부하 분산되지 않는다.
- 패킷이 순서 없이 도착하여 일부 애플리케이션이 중단될 수 있기 떄문이다.
- 항상 같은 흐름에서의 패킷은 같은 인터페이스로 부하 분산하여 항상 순서대로 도착해야 한다.
- 하나의 흐름이 항상 같은 인터페이승 부하 분산되기 때문에 모든 플로우는 포트 채널에 있는 
- 링크의 대역폭을 최댓값으로 받는다.

- EtherCnannel Protocols 
- LACP  ( Link Aggregation Control Protocol )
- 개방 표준
- 양쪽의 스위치가 포트 채널 생성 및 유지 관리를 협상한다.
- 가장 선호
- LACP 인터페이스는 활성 또는 수동으로 설정할 수 있다.
- 양쪽 모두 활성으로 설정되어 있으면 포트 채널이 나온다.

- interface range f0/23 - 24
- channel-group 1 mode active
- 새로운 논리 인터페이스인 포트 채널 인터페이스가 생성
- 포트 채널 1이 생성 -> 숫자가 있는 이유는 다른 이웃 스위치로 가는 다른 포트 채널이 있을 수 있기 때문

- interface port-channel 1
- switchport mode trunk
- 포트 채널이 생성되면 대부분의 인터페이스 설정은 포트 채널 레벨에서 설정된다.
- 이 레벨에서 native VLAN , allowed VLAN 등을 설정할 수도 있다.

- 반대쪽 스위치도 일치하는 설정을 구성해야 한다.




- PAgP ( Port Aggregation Protocol )
- Cisco 전용
- 양쪽의 스위치가 포트 채널 생성 및 유지 관리를 협상할 대 LACP 비슷하게 작동
- 사용하지 않는 것이 좋다

- Desirable or Auto 사이에서 고른다.
- 양쪽 모두 Desirable 설정되어 있으면 포트 채널이 나온다.

- interface range f0/23 - 24
- channel-group 1 mode Desirable

- interface port-channel 1
- switchport mode trunk


- Static Etherchannel
- 스위치는 생성과 유지 관리를 협상하지 않지만 포트 태널이 나오려면 양쪽의 설정이 서로 맞아야 한다.
- LACP가 양쪽에서 지원되지 않는 경우 사용한다.

- 포트 설정이 액세스 모드로든 트렁크 모드로든 여부와는 상관없이 양쪽에서 동일해야 하는 설정에는 속도와 이중이
- 포함된다.
- 트렁크에는 native VLAN과 allowed VLAN이 있고
- 액세스 포트라면 Access VLAN이 있다.

- interface range f0/23 - 24
- channel-group 1 mode on

- interface port-channel 1
- switchport mode trunk


- show etherchannel summary

- show spanning-tree vlan 1
- 스패닝 트리가 링크를 패쇄하는 것을 막기 위해
- 두 개의 물리적 인터페이스에 대한 완전한 대역폭을 얻기 위해


- Multi-chassis EtherChannel
- 스위치에 걸쳐 있는 물리적 링크를 하나의 논리적 인터페이스로 묶는 기술?
- 네트워크 루프 방지, 모든 링크의 활성화, 고가용성, 부하 분산 제공

- StackWise, VSS, vPC

특징	             LACP	                                   MEC
링크 집계 범위	  단일 스위치 내	                          다중 스위치 간
STP 의존성	          있음	                                    없음
장애 복구	    링크 장애 복구 가능, 스위치 장애 시 중단	스위치 및 링크 장애 복구 가능
대역폭 활용	      일부 링크 비활성화 가능	                        모든 링크 활성화

- Layer 3 Etherchannel
- interface range GigabitEthernet 1/0/1 - 2
- no switchport -> 3계층 포트
- channel-group 1 mode | active | auto | desirable | on | passive

- interface port-channel 1
- ip address 192.168.0.1 255.255.255.252
- no shutdown

- Layer 3 Campus Design
- 스패닝 트리는 링크의 절반을 차단한다는 점과 장애로부터 복구를 하는 속도도 느리다.
- 네트워크에 2계층 루프가 생기면 네트워크 전체가 중단될 텐데 2계층 루프가 없게끔 한다.
- 그러면 모든 곳에 3계층 링크를 둬서 스패닝 트리를 사용하지 않는 게 좋은게 아닌가?
- 액세스층과 분배층 사이에 2계층 링크를 사용하는 이유는?
- 3계층 스위치가 비쌋다..

- 3계층 스위치를 액세스층에 포함한 모든 곳에서 사용하게 되면
- 액세스층에서 분배층까지 3계층 링크가 생기게 되어
- 두 계층의 포트 모두가 IP 주소를 가지게 된다.
- 그리고 모든 곳이 3계층이기 떄문에 스패닝 트리가 실행되지 않는다.
- 스위치 링크 간의 경로가 스패닝 트리를 이용해 결정되는 게 아니라 라우팅 프로토콜에 따라 결정된다.
- 즉, 라우팅 프로토콜을 구성하게 될 것이고 경로 결정의 처리는 라우팅 프로토콜에 달려있다
- 라우팅 프로토콜을 사용하면 등가 다중 경로에 부하 분산을 지원하니 링크가 차단되지 않을 것이다.
- 모든 링크가 사용되며 트래픽 부하가 모든 링크에 걸쳐 분산된다.
- 라우팅 프로토콜은 장애 복구 또한 가능하고 스패닝 트리보다 휤씬 바르게 수렴한다.

- 3계층 스위치를 사용하게 되면 기본 게이트웨이가 2계층 스위치를 사용했을 때와 달리 분배층 스위치에 있지 않다.
- 종단 호스트의 기본 게이트웨이는 액세스층 스위치에 있게 된다. 
- 