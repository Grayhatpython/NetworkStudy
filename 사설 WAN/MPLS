- MPLS ( MultiProtocol Label Switching )
- IPv4/IPv6 패킷 또는 L2 프레임에 label을 첨부하여 전송하는 기술
- MPLS가 동작하는 라우터들이 MPLS 패킷을 수신하면 목적지 IP 주소 대신 label을 참조하여 해당 패킷을 스위칭한다.

- 용도로는 MPLS VPN ( Virtual Private Network, 가상 사설망) 구성이다
- VPN 내부와 외부 트래픽이 완전히 분리되어 비교적 안전한 망을 구성할 수 있다.
- VPN은 데이터 암호화를 통해 안전한 통신을 제공하지만, 통신망 자체가 모든 패킷을 전달하기 때문에 공격자의 패킷 역시 VPN 서버나 사용자의 장비에 도달할 가능성이 있습니다.

- MPLS는 통신회사 내부에서 사전에 설정된 경로 간에만 트래픽을 전송하므로, 다른 사용자들의 트래픽과 완전히 분리된다.
- 인터넷망을 이용하여 VPN을 구성할 떄와 다르게 MPLS VPN은 사용자가 MPLS 망 가입자로 제한되어 있으므로 아무나 다른 조직의 망으로 패킷을 전송할 수 없다.
- MPLS VPN 자체는 인증, 암호화를 제공하지 않아 보안을 위해서라면 인증,암호화 및 무결성 확인 기능을 제공하는 IPSec VPN 등을 함께 사용하는 것이 좋다.

- MPLS 헤더
- L2 헤더와 L3 헤더 사이에 4바이트 길이의 MPLS 헤더를 추가한다.

- L2 헤더 | MPLS 헤더 | L3 헤더 | 데이터 
  label(20bit) | EXP(3bit) | Bos(1bit) | TTL(8bit)

- label : MPLS에서 사용하는 label 표시, 0~1048757 사이의 값, 0~15값은 특별한 용도로 사용되고, 16이상의 값이 사용된다. 기본적으로 IOS는 16~100000 값을 사용한다
- EXP(experimental) : QoS 값을 표시할 때 사용 0~7사이의 값
- BoS(Bottom Of Stack) : 1이면 마지막 label임을 나타낸다, 여기서 label은 4바이트의 MPLS 헤더를 말한다. 0이면 현재의 label 다음에 또 다른 label이 있다.
- TTL: ip 헤더에서 사용하는 TTL과 같다. 패킷의 루프 방지

- 고객(CE)                              고객(CE)
         R1(PE) - R2(P) - R3(P) - R4(PE) 
- 고객(CE)                              고객(CE)

- MPLS VPN 라우터 종류
- PE(Provider Edge) 라우터 : 고객 라우터와 직접 연결되는 MPLS 라우터
- P(Provider) 라우터 : 고객 라우터와 직접 연결되지 않는 MPLS 라우터
- CE(Customer Edge) 라우터 : MPLS 망과 직접 연결되는 고객사의 라우터, 자신이 MPLS 망과 접속되어 있는지 모르며, 일반 네트워크 접속 시와 설정이 유사

- 프로토콜
- MPLS 라우터간에는 IGP 및 LDP(Label Distribution Protocol)을 동작시킨다
- MPLS 라벨 바인딩 정보 전송을 위해서 LDP를 사용
- 라벨 바인딩이란 특정 주소와 MPLS 라벨 값의 조합
- PE라우터 간에는 MBGP(multiprotocol BGP)를 사용하여 고객 정보를 교환
- PE와 CE간에는 정적 경로 혹은 어떤 라우팅 프로토콜을 사용해도 된다.


- MPLS label 부여 과정
          prefix : 1.1.4.4          prefix : 1.1.4.4            prefix : 1.1.4.4   
          MPLS label : 20           MPLS label : 30             MPLS label : X      1.1.4.4
- R1 <---------------------- R2 <---------------------- R3 <----------------------     R4
- R4가 MPLS 라우터 ID가 1.1.4.4인 패킷에는 라벨값을 부여하지 말고, 자신에게 전송하라는 LDP 바인딩 정보를 R3에게 보낸다. 최종 MPSL 라우터에게 패킷을 전송할 때에는 직전에서 label을 제거
- 특정 라우터 자신이 부여한 라벨 바인딩 정보를 로컬 바인딩이라고 한다.
- 다른 라우터에게서 요청받은 라벨 바인딩 정보를 리모트 바인딩이라고 한다.

- MPLS 패킷 전송 과정
- MPLS 라우터들이 목적지 IP 주소 대신 라벨값을 참조하여 패킷을 전송
- R1이 패킷을 수신하여 R4로 보내는 과정
     (push)             (swap)                        (pop)
 [20 | 1.1.4.4]       [30 | 1.1.4.4]                [  | 1.1.4.4]                  1.1.4.4
- R1 ----------------------> R2 ----------------------> R3 ---------------------->   R4
                local label(20)
                       ↓
                remote label(30)
                prefix(1.1.4.4)

- 처음 라벨을 부여하는 동작을 push
- 라벨값을 변경하는 동작을 swap
- 라벨을 제거하는 동작을 pop


- MPLS VPN과 연결되는 인터페이스의 IP 주소는 내부망에서 사설 IP 주소를 그대로 사용할 수 있다.
- CE 라우터는 MPLS 네트워크 구성에 대하여 알 수 도 없고, 알 핑요도 없다
- MPLS 네트워크와 PE 라우터에서 고객의 설정에 따라 동일한 라우팅 프로토콜을 사용하면 된다.
- 만약 OSPF를 사용한다면 MPLS 네트워크와 연결되는 부분을 모두 에어리어 0으로 설정해야 하며, 이를 OSPF 슈퍼 백본이라고 한다.