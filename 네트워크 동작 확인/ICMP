- ICMP ( Internet Control Message Protocol )
- 라우터, 스위치, PC, 서버 등 네트워크에 접속되어 있는 장비의 동작 상태를 확일할 떄 사용하는 프로토콜

- ICMP의 패킷 헤더에는 ICMP 타입과 코드 필드가 있으며, 이 값들을 이용하여 특정한 작업을 요청하고 응답한다

- Tyep |        Code                                        |          의미
-  0        0 = 항상 0                                            핑에 대한 응답 패킷

            0 = 네트워크 도달 불가
            1 = 호스트 도달 불가
            2 = 프로토콜 도달 불가
-  3        3 = 포트 도달 불가                                       목적지 도달 불가
            4 = 패킷분할이 필요하나 DF비트가 셋팅되어 있음
            5 = 소스 루트 실패 

-  8        0 = 항상 0                                                 핑 패킷

- 11        0 = TTL 초과                                              시간 초과
            1 = 분할 패킷 재조립 시간 초과


- 표준 Ping
- 핑은 네트워크의 동작 확인 및 장애처리용으로 가장 많이 사용되는 도구로 ICMP 패킷을 이용한다
- 핑은 이용자 모드나 관리자 모드에서 확인하고자 하는 네트워크 장비의 IP주소나 네트워크 주소를 입력하면 된다.

- ping [ip address]
- 100 바이트 크기의 패킷 5개를 연속해서 목적지로 전송하며, 2초 이내에 반향되어 오지 않으면 해당 장비나 도중의 네트워크에 장애가 발생한 것으로 간주한다.

- 핑 결과 코드
- ! : 핑이 성공함
- . : 지정된 시간내에 핑 패킷이 돌아오지 않음 ( 타입 아웃 )
- U : 목적지 도달 불가 메세지를 받음
- Q : 소스퀜치 ( 목적지가 혼잡합 )
- M : 전송도중 패킷분할이 필요하나 분할할 수 없음
- ? : 알 수 없는 패킷 타입

- Control + Shift + 6 
- 핑 도중에 중지

- 확장 Ping
- 핑을 할 떄 출발지 주소, 패킷 주소, 패킷 크기 등을 정할 수 있는 것으로 관리자 모드에서만 가능하다
- ping이라고만 입력하고, 나머지는 대화방식으로 지정

- Protocol [ip] 
- 핑에 사용할 네트워크 레이어 프로토콜을 지정, 기본값은 ip이며, 기본값을 사용하려면 엔터키를 누른다

- Targer IP address
- 목적지 주소

- Repeat count [5]
- 연속해서 몇 개의 패킷을 보낼지를 지정, 기본값은 5

- Datagram size [100]
- 핑에 사용할 패킷의 길이를 지정, 기본값은 100

- Timeout in secondes [2]
- 패킷이 돌아와야 하는 최대 시간을 지정, 기본값은 2
- 지연이 심하거나 규모 가 큰 네트워크에서는 이 값을 충분히 길게 지정해주어야 타임아웃 되지 않고 핑이 되는 것을 확인할 수 있다.

- Extended commands [n]
- 확장 명령어를 사용할지를 지정.
- 다음에 설명하는 조건들을 정의하려면 'y'라고 입력하여 확장 핑 모드로 들어가야 한다.

- Source address or interface
- 핑의 출발지 주소를 지정.
- 출발지 IP 주소를 지정하는 것을 소스 핑이라고 한다.
- 출발지를 지정하지 않으면 핑 패킷이 빠져나가는 인터페이스의 주소가 출발지 주소로 지정된다.
- 핑에서 출발지 주소는 핑이 돌아올 떄는 목적지 주소로 사용된다.
- 지정하는 주소는 반드시 라우터의 인터페이스에 부여된 주소를 사용해야 한다.
- 인터페이스 종류를 지정하려면 생략하지 말고 'fastethernet0/0'와 같이 이름 전체와 인터페이스 번호를 지정해야 한다

- Type of service [0]
- IP 패킷의 TOS(Type Of Service)를 지정.

- Set DF bit in IP header? [no]
- 라우터, 스위치와 같은 통신장비들은 인터페이스를 통하여 전송할 수 있는 최대 데이터 길이가 정해져 있으며, 이를 MTU (Maximum Transmission Unit 최대 전송 단위)라고 한다.
- MTU 사이즈보다 큰 IP 패킷을 특정 인터페이스를 통하여 전송해야 하는 경우에는 IP 헤더의 DF (Don`t Fragment, 분할 불가) 필더에 달려있다.
- 기본값인 'no'로 지정하면 패킷이 분할되어 전송된다.
- 'yes'로 지정되면 전송도중 패킷의 크기보다 작은 MTU를 가진 인터페이스를 만나면 패킷이 폐기된다.
- show interface [f0/0]
- 인터페이스 MTU 확인

- Data pettern [0xABCD]
- 데이터 패턴을 지정
- 기본적으로 데이터 부분에 '0xABCD'라는 데이터가 반복적으로 채워져 전송된다.
- 1010 1011 1100 1101이라는 데이터가 반복되어 100바이트 만큼 전송된다

- Loose, Strict, Record, Timestamp, Verbose[none]
- IP 패킷 헤더의 옵션 필드를 사용하여 다음과 같은 사항을 확인할 수 있다.

- Loose
- 일반적으로 핑 패킷이 전송되는 경로는 라우터의 라우팅 테이블에 따른다.
- 이 옵션을 사용하면 핑 패킷이 지나가는 경로를 미리 지정해준다.
- 중간 경로 중 일부를 생략할 수도 있고, 지정된 경로를 거칠 수 없으면 핑이 실패한다.
- 라우팅 테이블과 다른 경로의 동작 여부를 확인할 떄 유용하게 사용된다.
- Loose, Strict, Record, Timestamp, Verbose[none] : Loose
- Source route: [1.1.23.3]

- Strict
- Loose 옵션과 유사하며, 목적지로 가는 경로를 지정할 떄 일부를 생략하지 말고 모두 적어주어야 한다
- Loose, Strict, Record, Timestamp, Verbose[none] : Strict
- Source route: [1.1.12.2 1.1.23.3]

- Record
- 핑 패킷이 왕복하는 경로를 확인할 때 유용
- 목적지까지 가는 경로만을 알려주는 트레이스 루트와는 달리 이 옵션을 사용하면 왕복 경로를 모두 알려준다
- 왕복 경로가 다른 비대칭 경로(asymmetric route)를 찾아내는 데 유용하다

- Timestamp
- 목적지까지 가는 경로 중에 라우터에 설정되어 있는 시간을 표시해주는 옵션

- Verbose
- 핑 결과를 상세하게 표시할지 여부를 지정하는 옵션
- 사용하지 않으면 핑 성공 유무만 표시한다

- Sweep range of sizes [n]: y
- 패킷의 크기를 증가시키면서 핑을 할 떄 사용되며, 전송경로의 MTU를 확인할 때 유용하다.
- 이떄 DF 비트를 셋팅해야 ( Set DB bit in IP header? [no]:yes ) 하며, 그렇지 않으면 MTU가 작은 인터페이스에서 패킷이 분할되어 전송되므로 전송경로의 MTU들을 제대로 확인할 수 없다.
- 패킷의 최소 크기와 최대 크기 및 증가폭을 지정해주면 패킷의 크기를 차례로 증가시키면서 핑을 한다.
- Sweep min size [36] : 1000
- Sweep max size [18024] : 2000
- Sweep interval [1]: 100
- Success rate is 54 percent (6/11), round-trip min/avg/max = 1/40/140ms
- 위의 출력은 패킷의 크기를 1000바이트 부터 2000바이트까지 100바이트씩 차례로 증가시키면서 핑을 했을 때, 6개까지는 (MTU가 1500바이트) 핑이되고 이후로는 실패하는 것을 확인할 수 있다.
- 따라서 전송경로의 최소 MTU가 1500바이트라는 것을 알 수 있다.

- Success rate is 100 percent
- 핑이 성공한 비율

- round-trip min/avg/max = 1/40/140ms
- 각 패킷이 왕복하는 데 소요된 최소/평균/최대 시간을 밀리초 단위로 표시

- ping [1.1.30.3] ?
- 급하게 장애처리를 해야 할 떄 이렇게 직접 옵션을 지정하여 핑을 할 수 있다.

- 핑 패킷의 출발지 주소는 출력 인터페이스의 것을 사용
- 핑은 패킷이 목적지까지 갔다가 돌아와야 한다. 따라서 핑이 실패했다면 목적지까지 가는데 문제가 있는지 또는 돌아오는 데 문제가 있는지를 파악해야 한다.


