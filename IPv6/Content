- IPv6
- NAT는 IP가 정상적으로 작동하는 원리인 종단 간 IP 표준 모델을 벗어나기 때문에 보안 문제가 생기거나 특정 
- 애플리케이션에 혼란을 줄 수 있다.
- 128비트 주소
- 빌딩 보안과 호스트 유동성에 특화되어 호스트가 다른 물리적 공간으로 이동해도 같은 ip 주소를 유지할 수 있도록한다.
- IPv4나 IPv6 둘 다 사용할 수 있다.
- 듀얼 스택을 실행하면 호스트나 라우터의 네트워크 인터페이스가 동시에 IPv4나 IPv6 주소를 가질 수 있다. 

- Adderss Format
- X:X:X:X:X:X:X:X
- 각 X는 16비트의 16진법 필드이며, 16진법은 0부터 9까지와 A부터 F까지의 값을 의미한다.
- IPv4에서는 각 X부분을 옥텟(8bit)이라고 부르지만, 정식명칭은 아니자만 IPv6에서는 hextets, pieces, quartets 
- 라고 부르기도 한다.

- Address Shotening ( 주소 단축 )
- 모든 판매 회사의 장치에 똑같이 지원

- 각 필드의 문자열 앞에 있는 0을 제거한다.
- EX) 2001:0DB8:0000:0001:0000:0000:0000:0001 -> 2001:DB8:0:1:0:0:0:1

- 연속으로 0이 있는 필드를 ::으로 단축
- EX) 2001:0DB8:0000:0001:0000:0000:0000:0001 -> 2001:DB8:0:1:0:0:0:1 -> 2001:DB8:0:1::1
- :: 단축은 한 번만 할 수 있다
- 2001:0:0:1:0:0:0:B -> 2001::1:0:0:0:B or 2001:0:0:1::B 
- 2001::1::B는 안된다.

- IPv6 주소 타입
- Global Unicast Address
- IPv4의 공인 주소와 유사하며 사설 주소가 아니다.
- 인터넷 공인 기관에서 공개적으로 접근 가능한 IPv4 공개 주소
- 이러한 주소는 개별 호스트에 할당되며 방화벽과 같은 보안 정책에 의해 차단되지 않는 한 인터넷 어디서나 전역적
- 으로 접근이 가능하다.

- 집에서 개별적으로 사용하는 경우 일반적으로 DBCP에서 할당하는 /64가 제공된다.
- 개인에게 /64가 할당되는 이유는 IPv6 표준이 개별 호스트에 할당되는 주소는 /64 마스크를 사용해야 한다고 명시했으므로
- 주소의 절반은 네트워크 부분이 되고 나머지 절반은 호스트 부분이 된다


- 인터넷 기관은 인터넷에서 통신이 필요한 다양한 조직에 대해 전체 2000::/3 범위에서 블록을 할당된다.
- 회사에 일반적으로 /48 블록이 할당된다. -> 회사 규모에 따라 더 많은 주소 혹은 더 적은 주소를 받을 수 있다.
- 인터넷 기관에서 회사에 일반적인 /48 주소를 할당하면 일반적으로 /64 호스트 주소를 사용하는 경우 이는 관리기관에서 기대하는 바이며 회사는 이를 사용하여 자사의 여러 링크에 대한
- 내부 서브넷을 할당할 수 있는 16비트가 남게 된다
- 예를 들어 인터넷 기관에서 해당 회사에 2001:10:10::/48을 할당했다면 2001:10:10:0/64 ~ 2001:10:10:FFFF::/64까지의 서브넷이 남아서 내부 네트워크 세그먼트에 할당할 수 있는
- 서브넷 2001:10:10:0/64에서 2001:10:10:FFFF::/64까지를 남겨둔다
- 인터넷 기관은 더 큰 /48 블록을 더 작은 서브넷으로 나누기 위해 사용할 수 있는 16비트의 공간을 가지고 있다.
- 16비트는 65,536개의 가능한 서브넷을 의미하므로 대부분의 상황에서 가능할 것이다
- 그러면 호스트 주소에 64비트가 남게 된다
-      X:X:X:                    X                           :X:X:X:X
      Company                  Subnet                          Host
회사에 할당된 저체 블럭     다른 서브넷으로 나누어질 것      개별 호스트에 할당되는 부분

- IPv4에서는 포인트 투 포인트 링크에 /30을 사용하는 것이 표준이다
- 한쪽에 하나의 주소 다른 쪽에 하나의 주소를 제공하기 떄문이다
- 루프백 주소의 경우 /32을 사용하는 것이 표준이지만 IPv6는 항상 /64를 사용하고 어디에서나 /64를 사용하는 것이 권장된다.
- 이를 통해 전반적인 주소 지정 계획이 간소화된다.

- IPv4에서는 목적지 주소 255.255.255.255로 모든 호스트에 브로드캐스트를 지원한다.
- 라우터가 브로드캐스트 트래픽을 기본으로 전송하지 않아 트래픽이 로컬 서브넷의 모든 부분에 도달하지만 그 이상 넘어가지는 않는다.
- IPv6에서는 브로드캐스트 트래픽을 지원하지 않지만 목적지 주소 FF02::1을 이용해 로컬 서브넷에 있는 모든 호스트에 멀티캐스를 지원한다. ->  IPv4 브로드캐스트와 같은 기능
- 예를 들어 호스트가 DHCP 요청을 보냈을 떄 IPv4의 경우 브로드캐스트 주소가 모든 호스트에 도달해서 처리하지만 IPv6의 경우 DHCP 서버 멀티캐스트 주소인 FF05::1:에 도달한다.
- 즉, DHCP 서버만 트래픽을 처리하기 떄문에 IPv6의 멀티캐스트 트래픽이 브로드캐스트보다 더 효율적이다.

- ipv6 unicast-routing
- IOS 라우터에 ipv4 라우팅은 기본으로 활성화되지만 ipv6은 직접 활성화해야한다.
- int f0/0
- ipv6 add 2001:db8:0:1::1/64
- int f2/0
- ipv6 add 2001:db8:0:0::1/64

- show ipv6 interface brief

- EUI-64 Address
- 일반 인터페이스에 IPv6 주소를 직접 구성하지 않아도 자동으로 생성한느 방법
- 주소를 구성할 인터페이스와 사용할 /64 네트워크 접두사를 입력하면 된다.
- 주소에서 호스트를 가리키는 부분은 인터페이스의 MAC 주소에서 비롯되며 MAC 주소는 반드시 글로별 고유 주소이다.
- 호스트 부분은 64비트인데 반해 MAC 주소의 길이는 48비트이기 떄문에 MAC주소에서 호스트 부분을 파생하기 위해서는 MAC 주소를 길게 만들어야 한다.
- MAC 주소를 48비트에서 64비트로 확장하려면 중간에 FF:FE를 넣고 일곱 번째 비트를 뒤집는다.

- int f0/0
- ipv6 address 2001:db8:0:1::/64 eui-64
- int f2/0
- ipv6 address 2001:db8:0::/64 eui-64

- Serial 인터페이스 같이 라우터의 이더넷이 아닌 다른 인터페이스에 구성되면 첫 번쨰 이더넷 포트의 MAC주소를 빌려오겠지만 권장하지 않는다
- 라우터 인터페이스에는 EUI-64를 사용하지 마라.
- 수동으로 설정하는 것에 비해 랜덤 ip 주소로 인해 관리에 용이하지 않다

- 모든 종단 호스트마다 ipv6 주소를 구성하지 않고 ipv4에서처럼 dhcp를 이용하거나 SLAAC라는 기능을 통해 인터페이스에 자동으로 주소를 생성


- Unique Local
- RFC 1918 사설 주소와 유사
- IPv4 -> 10.x.x.x 172.16.x.x ~ 172.31.x.x 192.168.x.x
- 공개적으로 접근할 수 없다 
- FC00::/7 범위에서 할당되며 호스트에는 /64 주소가 할당되어야 한다.
 

- Link Local 
- 특정 링크에서의 통신에만 유효 
- 다른 링크로 트래픽을 보낼 수 없다.
- FE80::/10 ~ FEB0::10 범위에서 할당 
- 호스트에는 /64 주소가 할당되어야 한다.
- 트래픽은 수고 받을 수 없지만 해당 로컬 링크에서만 유효 라우터의 반대편의 다른 인터페이스로는 라우팅 되지 않는다
- 로컬 링크를 넘어서 포워딩되지 말아야 할 통신에 사용될 수 있다.
- 라우팅 프로토콜, 헬로 패킷, 업데이트 등이 이에 해당 
- ipv6가 활성화된 시스코 라우터 인터페이스에서는 링크 로컬 주소가 필수적 
- IPV6를 인터페이스에서 활성화하면 EUI-64 주소를 사용해 자동으로 생성된다.
- 자동으로 생성된 EUI-64 주소는 수동으로 링크 로컬 주소를 구성하여 덮어쓸 수 있다.

- int f0/0
- ipv6 address fe80::1 link-local
- int f2/0
- ipv6 address fe80::1 link-local
- 로컬 링크에서만 유효  인터페이스 수준에서 고유하기 떄문에 여러 인터페이스에서 동일한 주소를 사용할 수 있다.


- Multiple IPv4 Address
- int f0/0
- ip address 10.10.10.1 255.255.255.0
- ip address 192.168.10.1 255.255.255.0
- show run interface f0/0
-  ip address 192.168.10.1 255.255.255.0
- 두번쨰 ip 주소를 입력햇을 때 첫 번쨰 ip 주소를 덮어쓴다

- ip address 172.16.0.1 255.255.255.0 secondary
- show run interface f0/0
-  ip address 172.16.0.1 255.255.255.0 secondary
-  ip address 192.168.10.1. 255.255.255.0
- 야러 ipv4 주소를 설정하려면 secondary 보조 키워드를 사용 -> 사용은 primary ip가 사용된다
- 인터페이스에서는 최대 두 개의 ip 주소를 가질 수 있다.

- Multiple IPv6 Address
- int f0/0
- ipv6 address FE80::1 link-local
- ipv6 add 2001:db8:0:0::1/64
- ipv6 add 2001:db8:0:1::1/64
- 동일 인터페이스에 여러 ipv6 주소를 가질 수 있다.

- show run interface f0/0
-  ip address 172.16.0.1 255.255.255.0 secondary
-  ip address 192.168.10.1. 255.255.255.0
-  ipv6 address FE80::1 link-local
-  ipv6 address 2001:db8::1/64
-  ipv6 address 2001:db8:0:1::1/64
- 듀얼 스택 라우터
- 라우터로 들어오는 패킷이 IPv4 목적지 주소를 가지고 있으면 IPv4 라우팅을 사용 , IPv6면 IPv6 라우팅
- 라우터를 통해 트래픽을 보내는 최종 호스트의 애플리케이션에 따라 달라진다

- 라우팅 프로토콜 트래픽을 위한 하나의 링크 로컬 주소와 일반 라우팅을 위한 하나의 글로벌 유니캐스트 주소를 가지는 것이 라우터에서 일반적이다.

- 링크 로컬 주소로 ping을 보낼 떄 모든 링크 로컬 주소가 FE80으로 시작하는 같은 접두사를 가져서 라우터가 어떤 인터페이스에 트래픽을 보내야 할지 모른다.
- Out Interface에 인터페이스를 지정해줘야 한다.

- SLAAC Stateless Address AutoConfiguration ( 무상태 주소 자동 구성 )
- IPv6에서는 일반적으로 데스크톱 컴퓨터와 같은 호스트가 IPv6 주소를 할당받을 수 있다.
- 이는 관리자가 각 호스트에 개별적으로 ip 주소를 수동으로 설정하는 정적 주소 할당 방식이나 ipv4의 dhcp와 동등한 dhcpv6나 ipv4에는 없는 SLAAC를 통해 가능
- dhcp 서버를 사용하는 경우 서버는 할당한 ip주소와 mac 주소의 매핑을 추적한다. 
- 서버는 할당한 ip 주소와 매핑된 mac 주소에 대한 상태 정보를 유지 이것이 상태(stateful) 기반 주소 할당
- 호스트가 로컬 라우터로부터 자신의 IPv6 인터페이스가 위치한 /64 서브넷을 학습한다.
- 호스트는 이 정보를 사용하여 자신의 IPv6 주소를 생성한다. 
- 이는 일반적으로 EUI-64 주소를 기반으로 하지만 현대 운영 체제는 표준화된 EUI-64 방식을 사용하지 않는다.
- 이는 MAC 주소로 PC를 추적할 수 있어 개인정보 보호 문제를 야기한다
- 따라서 최신 운영체제는 주소의 64비트 호스트 부분을 완전히 무작위로 생성하는 다른 방법을 사용한다.
- SLAAC를 사용할 때 라우터는 어떤 호스트가 어떤 IP 주소를 가지고 있는지 추적하지 않는다. -> IP주소와 MAC주소의 매핑을 추적하지 않는다.
- 따라서 이는 DHCP가 IP주소를 할당할 때 상태 기반 주소 할당과는 달리 비상태 주소 할당이다.

- 글로벌 유니캐스트 IPv6 주소가 라우터 인터페이스에 구성되면 라우터는 기본적으로 해당 인터페이스의 64비트 네트워크 부분을 광고하는 라우터 광고를 보낸다
- 이는 ICMP를 사용하여 전송되며 인터페이스의 링크 로컬 주소를 소스 주소로 사용하여 '모든 노드' 멀티캐스트 주소로 전송된다 -> 로컬 링크의 모든 사람에게 전송
- 그래서 호스트가 해당 링크에서 네트워크 부분이 무엇인지 알수 있으며 이를 사용하여 전체 128비트 IPv6 주소를 생성할 수 있다.
- 호스트도 라우터 요청 메세지를 보내어 정보를 요청할 수 있다.
- 호스트에게 어느 서브넷에서 IP 주소를 생성할 지 알려주는 것외에도 라우터는 호스트에게 기본 게이트웨이로 라우터를 사용하라고 알려준다.
- original 구현에서는 기본 게이트웨이 주소외에 다른 정보를 지원하지 않았다
- pc는 SLAAC로부터 dns 서버를 배울 수 없다 -> 따라서 어쩃든 dhcp 서버가 여전히 필요하다
- IP 주소가 SLAAC에 의해 할당되고 DNS서버가 DHCP에 의해 할당되면 DHCP 서버가 단지 DNS 정보를 보내고 있기 떄문에 여전히 비상태 구성으로 이루어진다
- DHCP 서버는 IP 주소를 제공하지 않기 떄문에 어떤 IP 주소가 어떤 MAC 주소에 매핑되는지를 추적하지 않는다. SLAAC가 이를 학습하고 있다.
-
- 호스트가 SLAAC를 사용하는 경우 소스 주소 ::을 사용하여 트래픽을 전송한다.
- ::는 지정되지 않는 주소
- 호스트가 SLAAC이나 DHCP로부터 IP 주소를 받을 떄 정상적인 IPv6 주소를 받을 떄 까지 그것을 사용할 것이다.
- ::는 미지정 또는 알 수 없는 주소이기 떄문에 기본 정적 경로에도 사용된다.
- IPv6 경로를 ::/0 설정하면 IPv4의 기본 경로인 0.0.0.0 0.0.0.0 경로와 동일하다

- Neighbor Discovery
- IPv4의 ARP의 IPv6버전이며 매우 유사한 방식이다
- ARP 요청과 응답을 사용하는 대신 ICMP 이웃 탐색 요청(Neighbor Solicitations)과 이웃 광고(Neighbor Adverisements)를 사용한다.
- 기본적으로 ARP 요청 및 응답과 동일
- 이웃 탐색 요청 메세지는 요청된 노드 멀티캐스트 주소로 전송되며 해당 서브넷의 모든 호스트에 도달한다

- show ipv6 neighbors


- IPv6 Routing
- IPv4랑 비슷하지만 각자 고유의 라우팅 표가 있다
- ipv6 unicast-routing
- 같은 서브넷에 있는 호스트와 통신할 수 있다.
- 만약 호스트가 라우터를 통해 IPv6 트래픽을 보내려고 하면 라우터가 트래픽을 전송하지 않지만 라우터에 핑을 실행할 수는 있어서 헷갈린다
- 라우터는 반대쪽 어디에든 핑을 실행할 수 있지만 IPv6 유니캐스트 라우팅이 활성화되지 않았다면 트래픽은 전송하지 않는다는 뜻이다

- show ipv6 route

- 라우터가 직접 부착되지 않는 네트워크에 대한 트래픽을 받으면 트래픽 전송을 위해 도달하는 경로를 알아햐 한다.
- 목적지로 가는 정적 경로를 추가하거나 RIP, EIGRP, OSPF, BGP나 ISIS 같은 라우팅 프로토콜을 통해 라우터가 학습하도록 해야한다.