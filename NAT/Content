- NAT
- 사설 IP 주소인 대상 주소가 있는 트래픽을 인터넷으로 보내는 경우 서비스 제공업체 라우터는 
- 해당 트래픽을 삭제한다.
- 사설 주소는 원래 인터넷 연결이 없는 호스트용으로 설계되었다. 
- 공개 IP 주소는 비용이 든다.

- 클래스 별 사설 IP 주소 대역 
- Class A
- 10.0.0.0 - 10.255.255.255
- 10.0.0.0/8
- 10.0.0.0 255.0.0.0

- Class B
- 172.16.0.0 - 172.31.255.255
- 172.16.0.0./12
- 172.16.0.0 255.240.0.0

- Class C
- 192.168.0.0 - 192.168.255.255
- 192.168.0.0/16
- 192.168.0.0 255.255.0.0

- IPv6는 IPv4와 역호환되지 않기 때문에 전환하는 것이 쉽지 않다
- 네트워크 주소 변환인 NAT는 조직이 IPv6로 마이그레이션할떄까지
- IPv4 주소 부족을 완화하기 위한 임시 해결 방벅으로 구현되었다.

- NAT를 사용함으로써 내부 네트워케엇 사설 IP 주소를 사용할 수 있고 이를 외부 공용 IP 주소로 변환하여
- 호스트에게 인터넷 접근 권한을 부여할 수 있다.
- 내부에 있는 호스트는 몇 개 또는 단일 공용 IP 주소를 외부에 공유할 수 있다.

- RFC1918 IPv4 주소는 기본적으로 호스트 내부에 숨기 떄문에 보안상 이점이 있다.
- 공격자가 외부에서 내부로 직접 연결하는 것은 불가능하다

- Static NAT
- 공용 및 사설 IP 주소 간의 영구적인 일대일 매핑
- 수신 연결을 수락해야 하는 서버에 사용되는데 예를 들어 직접 호스팅하는 공용 웹 서버나 메일 서버가 이에 해당

- 예시
- 서비스 공급자로부터 공용 IP 주소 범위인 203.0.113.0/28를 구했다
- /28이므로 14개의 공용 IP 주소를 제공한다.
- 이중에 203.0.113.2는 인터넷 에지 라우터 R1의 외부 인터페이스에 사용
- 해당 링크의 서비스 공급자 측에서 203.0.113.1를 사용 -> 게이트웨이
- 203.0.113.3 ~ 203.0.113.14가 남고 할당에 사용할 수 있다
- 10.0.1.10는 회사 내부에 있는 웹 서버이며 인터넷에 있는 사람들이 웹사이트를 탐색할 수 있도록 인터넷에서 
- 들어오는 연결을 수락해야 한다. 따라서 들어오는 연결을 수락하려면 고정된 공용 IP 주소를 할당해야 한다.
- 이떄 범위에서 사용 가능한 첫 번쨰 주소인 203.0.113.3을 사용하고 
- 외부 사람들이 웹 서버에 연결할 떄 사용할 수 있는 영구 공용 IP 주소로 제공 된다.

- 10.0.1.10 내부에 있는 웹서버는 사설 IP 주소를 사용 중이기 떄문에 외부에서 들어오는 연결을 위해 
- 외부 F0/0 인터페이스에 있는 공용 IP 주소 203.0.113.3을 내부 F1/0 인터페이스의 10.0.1.10으로 변환하는
- 정적 영구 NAT 변환을 구성해야 한다. 
- 변환은 양방향으로 이루어진다.
- 외부에서 내부로 들어오는 트래픽에 대해 정적 NAT 변환을 구성할 것이다.
- 서버는 인터넷으로 트래픽을 다시 보내야 하지만 이에 대해 별도의 NAT 규칙을 구성할 필요는 없다.
- 정적 NAT 규칙이 양방향으로 적용되기 때문에 나가는 트래픽도 처리된다.

- R1에서는 먼저 외부 인터페이스와 내부 인터페이스를 지정해야 한다.
- int f0/0
- ip nat outside

- int f1/0
- ip nat inside
                                내부 IP   외부 IP
- ip nat inside source static 10.0.1.10 203.0.113.3


- show ip nat translation
Pro     Inside Global       Inside local        Outside local           Outside global
icmp    203.0.113.3:1       10.0.1.10:1         203.0.113.20:1          203.0.113.20:1
tcp     203.0.113.3:80      10.0.1.10:80        203.0.113.20:45849      203.0.113.20:45849
--      203.0.113.3         10.0.1.10           ---

- Inside local 
- 내부 호스트 운영 체제에 구성된 실제 IP 주소
- 내부 사설 주소

- Inside Global
- 외부 네트워크에서 도달할 수 있는 내부 호스트의 NAT 주소
- 내부 호스트에 도달하는 데 사용된 공인 주소

- Outside local    
- 내부 네트워크에 표시되는 외부 호스트의 IP 주소

- Outside global
- 호스트의 소유자가 외부 네트워크 호스트에 할당한 IP 주소

- 단방향 NAT에서는 외부 로컬 주소와 외부 전역 주소가 동일하 것으로 표시



- Dynamic NAT
- 필요에 따라 선착순으로 할당되는 공인 IP 주소의 풀을 이용한다.
- 내부 호스트가 인터넷에 연결할 때 사용하지만 들어오는 연결은 허용하지 않는다.
- 필요할 때마다 사용 가능한 공인 IP 주소를 할당받는다.

- 예시
- 서비스 공급자로부터 공용 IP 주소 범위인 203.0.113.0/28를 구했다
- /28이므로 14개의 공용 IP 주소를 제공한다.
- 이중에 203.0.113.2는 인터넷 에지 라우터 R1의 외부 인터페이스에 사용
- 해당 링크의 서비스 공급자 측에서 203.0.113.1를 사용 -> 게이트웨이
- 위의 정적 NAT를 통해 203.0.113.3은 구성햇기 떄문에 203.0.113.4 ~ 203.0.113.14까지 남았다
- 10.0.2.0/24 네트워크 호스트는 들어오는 연결을 허용할 필요가 없지만 인터넷으로 나가는 연결에는 공인 ip 주소가 
- 필요
- 남아 있는 ip 주소를 이 용도로 사용
- 203.0.113.4 ~ 203.0.113.14까지를 풀에 넣어 내부 호스트가 외부로 트래픽을 보낼 떄 ip 주소가 선착순으로 할당
- 맨 처음 트래픽을 보내는 호스트에 풀의 첫번쨰 주소인 203.0.113.4가 그 다음 호스트에는 203.0.113.5가 부여되며
- .14까지 차례대로 진행

- 외부와 통신하는 모든 내부 호스트에 공인 ip 주소가 필요하다
- 30개의 호스트가 있으면 30개의 공인 ip 주소가 필요하다
- 표준 동적 NAT에 의해 풀에 있던 주소가 모두 사용되면 내부 호스트로부터 나가는 새로운 연결은 실패한다.
- 연결을 변환할 공인 IP 주소가 남아있지 않기 떄문이다
- 이렇게 호스트가 트래픽을 외부로 보내려는데 남은 주소가 없는 경우 기존의 연결이 끊겨서 변환됐던 주소가
- 다시 풀에 들어와 새 트래픽을 보낼 수 있을 떄까지 기다려야 한다.

- interface f0/0
- ip nat outside
- interface f2/0
- ip nat inside

- ip nat pool [name] 203.0.113.4 203.0.113.14 netmask 255.255.255.240
- 내부 호스트가 사용할 글로벌 주소의 풀을 구성

- access-list 1 permit 10.0.2.0 0.0.0.255
- 변환할 내부 IP 주소에 기반한 액세스 리스트 생성
- 출발지 주소에 의해 내부에 호스트를 지정하려면 표준 ACL을 사용하면 된다.

- ip nat inside source list 1 pool [name]

- clear ip nat translation [* : 모든 변환 제거 ]
- 변환 표에서 변환 엔트리를 제거할 때 사용 

- show ip nat statistics
- 얼마나 많은 주소가 실제로 변환됐는지 

- debug ip nat