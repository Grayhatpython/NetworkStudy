- VTP ( VLAN Trunking Protocol )
- 하나의 스위치에 설정된 VLAN 번호와 이름을 다른 스위치에게 알려줄 때 사용하는 프로토콜이다.

- VTP 동작 원리
- 1. 스위치에서 VLAN을 추가, 수정 또는 삭제한다. 이 경우, VLAN 설정 정보가 변경되고, 새로운 VLAN 설정 정보를 다른 스위치에게 전송해야 한다.
- 2. 스위치는 VTP 설정 번호를 기존값보다 1을 증가시켜 다른 스위치에게 변경된 VLAN 정보와 함께 전송한다.
- 3. VTP 정보를 수신한 스위치는 자신의 VTP 설정번호와 수신한 번호를 비교한다. 
-   수신한 정보의 VTP 설정 번호가 더 높으면 자신의 VLAN 정보를 새로운 정보로 대체한다.
-   수신한 정보의 VTP 설정 번호와 자신의 번호가 동일하면 수신한 정보를 무시한다.
-   수신한 정보의 VTP 설정 번호가 자신의 번호보다 낮으면 자신의 VTP 정보를 전송한다.

- PC1 ← → (VLAN 10)    (트렁크 포트)    (VLAN 10) ← → PC3
                     SW1   ← →   SW2 
                          F1/10
  PC2 ← → (VLAN 20)     (VLAN 10)     (VLAN 20) ← → PC4
                        (VLAN 20) 

- VTP 설정 
- VTP가 동작하기 위한 최소의 조건은 스위치들이 트렁크 포트를 통하여 연결되어야 하고, VTP 도메인 이름이 같아야 한다.
- vtp domain [MyVTP] 
- 대소문자 구분한다.

- show vtp status
- vtp 상태 확인
- Configuration Revision
- VTP 설정번호를 나타낸다. VLAN을 추가하거나, 삭제하거나, 이름을 변경할 때마다 이 번호가 1씩 증가한다.

- Number of existing VLANs
- 현재 설정된 VLAN 수를 표시

- VTP Operating Mode
- VTP [서버/클라이언트/트랜스패런트] 모드 종작 중임을 표시

- VTP Domain Name
- VTP 도메인 이름


- VTP 모드
- 서버,클라이언트,트랜스패런트 세 종류가 있다.
- 서버모드에서는 VLAN을 만들거나 지우거나 또는 VLAN의 이름을 변경할 수 있으며, 자신의 VLAN 설정 정보를 다른 스위치에게 전송한다.
- 다른 스위치에게서 받은 정보와 자신의 정보를 일치시키며, 이를 다른 스위치에게 중계한다.
- 클라리언트 모드에서는 VLAN을 만들거나 삭제할 수 없다. 그러나 자신의 VLAN 설정 정보를 다른 스위치에게 전송하며, 다른 스위치에게서 받은 정보와 자신의 정보를 일치시키고, 이를 다른 스위치에게 중계한다.
- 트랜스패런트 모드는 자신의 VTP 정보를 다른 스위치에게 전송하지 않으며, 다른 스위치에게서 받은 정보와 일치시키지 않는다. 다른 스위치에게서 받은 정보를 중계하며, 자신이 사용할 VLAN을 만들거나 삭제할 수 있다.
                        VLAN 생성,변경,삭제  | VTP 정보 전송 | VTP 정보 중계 | VTP 정보 동기
- 서버 모드                       O                 O              O            O
- 트랜스패런트 모드                O                 X              O            X
- 클라이언트 모드                  X                 O              O            O

- vtp mode client

- vtp mode transparent
- 자신에게 적용할 VLAN을 만들거나 제거할 수 있다. VLAN 번호 1006이상인 확장 VLAN을 만들 때에도 트랜스패런트 모드에서 설정해야 한다.


- VTP 설정번호 초기화
- 새로운 스위치를 추가할 때에는 VTP 설정번호를 초기화시켜야 한다.
- 스위치를 추가하기 전에 VTP 도메인 이름과 트렁크를 설정하고, 여러 가지 VLAN을 만들었다가 다 지우고 기존의 스위치와 접속하는 경우를 생각해보자
- 새로운 스위치의 VTP 설정번호가 기존 스위치들보다 더 높다면 기존 스위치에 설정되 VLAN 정보가 새로운 스위치의 것으로 대체된다.
- 포트에는 VLAN 번호가 할당되어 있지만 VLAN 데이터베이스에는 해당 VLAN 번호가 없다면 포트의 LED는 노란색으로 변경되고 통신이 안된다.
- 이때에는 얼른 VLAN10,20과 같이 기존에 사용했던 VLAN을 만들어야 한다.
- 새로운 스위치를 추가할 때에는 반드시 VTP 설정번호를 0으로 초기화시켜야 한다.

- VTP 설정번호를 0으로 초기화시키는 방법
- 1. VTP 도메인 이름을 다른 것으로 변경하기
- 2. VTP 모드를 트랜스페런트로 변경하기
- 3. VLAN 데이터베이스를 삭제하고 재부팅하기
0
-  delete vlan.dat
-  reload
-  스위치의 VLAN 및 VTP 관련 정보는 플래시에 vlan.dat라는 이름으로 저장되어 있다. VLAN 데이터베이스 파일을 삭제하고 재부팅해도 VTP 설정번호가 초기화 된다.0
