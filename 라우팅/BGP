- BGP ( Border Gateway Protocol )
- 서로 다른 조직의 네트워크를 연결할 때 사용하는 라우팅 프로토콜
- 예를 들어, 학교 기업체, 정부 등이 두 개 이상의 인터넷 사업자와 연결할 떄 혹은 인터넷 사업자들끼리의 네트워크를 연결할 떄에도 BGP를 사용한다.

- 하나의 링크만 사용하여 연결하는 것을 싱글 호밍이라고 하며, 두 개 이상의 링크를 사용하는 것을 멀티 호밍이라고 한다.
- 대부분 멀티 호밍을 사용하나, 싱글 호밍에 대해서만 알아보자
- 하나의 조직당 하나의 BGP 번호를 사용하는데 이 번호를 AS(Autonomous System) 번호라고 한다.
- 동일한 네트워크 내부에서도 BGP를 사용할 수 있는데 이를 내부 BGP 라고한다.
- 서로 다른 조직 사이에서 동작하는 외부 BGP를 알아보자

- 주로 멀티캐스트 방식으로 라우팅 정보를 전송하는 IGP와는 다르게 BGP는 유니캐스트 방식으로 라우팅 정보를 전송하며, TCP 포트 번호 179번을 사용하여 신뢰성 있는 통신을 한다.
- 현재 사용되는 버전은 4이고, 'BGP4'라고 부른다.
- IGP는 각 라우팅 프로토콜이 사용하는 메트릭에 따라 가장 '빠른'경로를 최적 경로로 선택하지만 BGP는 그와는 다르게 조직 간에 계약된 정책에 따라 최적 경로를 결정한다.

- 하나의 조직인 IGP는 라우팅 정책을 다른 조직에 구애받지 않고 설정할 수 있지만, BGP는 수많은 AS로 구성되어 있고, 그 중 하나인 해당 조직의 AS에서 라우팅 정책을 설정하여 원하는 라우팅이 이루어지게 해야 한다.

- IGP 장애 발생 시 해당 조직의 라우팅만 영향을 받지만, BGP는 장애발생 시 잘못되면 국가 또는 전세계의 네트워크에 영향을 미칠 수 있다.
- IGP에 의해 유지되는 네트워크 수는 작게는 수개~수천 개가 넘지 않지만 BGP는 보통 수만~수십만 개 이상의 네트워크가 라우팅 테이블에 인스톨된다


- BGP를 설정하기 전에 동일한 AS 내부에서는 IGP를 동작시켜야 한다.
- IGP가 필요한 이유는 AS 내부에서의 라우팅을 위해서다.
- 어느 AS에도 소속되지 않는 구간을 BGP DMZ 구간이라고 한다. BGP DMZ 구간은 IGP에 포함되지 않는다.

- 인접한 BGP 라우터를 BGP 피어 또는 네이버라고 한다.
- 서로 다른 AS에 속하는 네이버를 eBGP(external BGP) 네이버 또는 eBGP 피어라고 한다.
- 동일한 AS에 속하는 네이버를 iBGP(internal BGP) 네이버 또는 iBGP 피어라고 한다.
- iBGP와 eBGP는 설정하는 방법이 약간 다르다.


- eBGP 네이버 설정하기
- router bgp 1
- AS 번호를 지정하면 BGP 설정 모드로 들어간다
- AS 번호는 2바이트와 4바이트 두 종류가 있다. 2 바이트 AS 번호 중 64512~65534까지는 사설 AS 번호다. IP 주소와 마찬가지로 IANA에서 공인 AS 번호를 부여한다.

- bgp router-id 1.1.2.2
- BGP의 라우터 ID를 지정한다. 
- 특별히 지정하지 않으면 OSPF가 라우터 ID를 지정하는 것과 동일한 방식으로 라우터 ID가 지정된다.

- neighbor 1.1.23.3 remote-as 2
- eBGP 네이버의 IP 주소와 해당 네이버가 소속된 AS 번호를 지정한다.
- eBGP 네이버를 지정할 때 사용하는 IP 주소는 특별한 경우를 제외하고 네이버와 직접 연결된 넥스트 홉 IP 주소를 사용한다. BGP는 반드시 지정해줘야 한다.

- network 1.1.10.0 mask 255.255.255.0
- network 1.1.12.0 mask 255.255.255.0
- network 1.1.20.0 mask 255.255.255.0
- BGP를 통하여 다른 라우터에게 전송할 네트워크를 지정한다.
- 서브넷팅되지 않은 네트워크를 지정할 때는 mask 옵션을 사용할 필요가 없다.
- 대부분의 경우 IGP는 해당 라우터에 접속되어 있는 네트워크만을 자신의 라우팅 프로세스에 포함시킬 수 있다.
- BGP는 network 명령어를 사용할 때 네트워크가 꼭 해당 라우터에 접속된 것이 아니어도 된다. 해당 라우터의 라우팅 테이블에는 반드시 저장되어 있어야 한다..
- 두 AS 사이에 있는 네트워크를 DMZ 네트워크라고 하고, 일반적으로 BGP 네트워크에 포함시키지 않는다.
- BGP를 통하여 광고받은 네트워크 앞에는 'R'라는 코드가 첨부된다.

- show ip route bgp

- BGP가 설정되지 않아서 라우팅 테이블에 다른 AS 네트워크가 없는 경우 이를 해결하기 위해 eBGP가 설정된 라우터에서 디폴트 루트를 생성하여 
- OSPF 및 EIGRP를 통하여 내부 네트워크 방향으로 광고하도록 설정해야 한다.

- router ospf 1
- default-information originate always

- interface [f0/0]
- ip summary-address eigrp 1 0.0.0.0 0.0.0.0


- BGP 테이블
- 네이버에게서 BGP 라우팅 정보를 수신하면 입력 정책을 적용한 다음 BGP 테이블에 저장한다.
- BGP 테이블에 저장된 경로 중에서 최적의 경로를 선태갛고, 다른 라우팅 프로토콜과 AD를 비교한 다음 라우팅 테이블에 저장한다.
- BGP 테이블에 있는 네트워크에 출력 정책을 적용한 다음 인접 라우터에게 라우팅 정보를 전송한다.

- show ip bgp
- BGP table version is 7, local router ID is 1.1.2.2
- BGP 테이블이 변환된 횟수를 의미
- BGP 라우터 ID를 의미
- Network | Next Hop | Metric | LocPrf | Weight | Path
- Network : 목적지 네트워크
- Next Hop : 목적지 네트워크와 연결되는 넥스트 홉 IP 주소
- Path : 해당 네트워크가 가져온 AS 번호를 표시

- BGP 네이버 테이블
- show ip bgp summary

- Up/Down : 네이버가 구성된 이후의 시간
- State/PfxRed
- 네이버와의 상태 또는 네이버에게서 광고받은 네트워크 수(Prefix Received)를 표시한다.
- 처음 네이버를 구성할 때에는 일시적으로 'Active','Idle' 등의 상태가 표시되나, 30초 후부터는 반드시 상태가 아닌 네이버에게서 광고받은 네트워크의 수가 표시되어야 한다.