- EIGRP ( Enhanced Interior Gateway Routing Protocol )
- 시스토에서 개발한 디스턴스 벡터 라우팅 프로토콜이다.
- RIP와 마찬가지로 스플릿 호라이즌이 적용되고, 주 네트워크 경계에서 자동 축약된다.
- RIP나 OSPF에서 지원하지 않는 언이퀄 코스트(unequal cost) 부하 분산을 지원하여 메트릭 값이 다른 복수 개의 경로를 동시에 사용할 수 있다.
- 대체 경로의 대역폭까지 활용함으로써 링크 활용도를 극대화시킬 수 있다.

- 기본적인 EIGRP 설정
- router eigrp 1
- 1~65535 사이의 AS 번호를 사용하여 EIGRP 설정 모드로 들어간다. AS번호는 BGP와 달리 관리자가 임의의 번호를 사용하면 되고, EIGRP가 동작하는 모든 라우터에서 동일한 번호를 사용해야 한다.
- 번호가 서로 다르면 서로 라우팅 정보를 교환하지 않는다.
- network 1.1.10.1 0.0.0.0
- 인터페이스에 설정된 IP 주소와 와일드카드를 사용하여 EIGRP가 동작할 인터페이스를 지정한다.
- network 1.1.12.1 0.0.0.0
- network 1.1.13.1 0.0.0.0

- show ip route eigrp
- 라우팅 테이블 확인
- 코드 'D'는 해당 경로를 EIGRP를 통하여 광고받은 것을 의미한다.


- EIGRP 네이버 ( Neighbor )
- RIP는 라우팅 프로세스에 포함된 인터페이스로 무조건 30초마다 라우팅 테이블을 전송한다.
- 다른 라우팅 프로토콜들은 라우팅 경로를 전송하기 전에 먼저 상대방 라우터와 네이터를 맺은 후 라우팅 정보를 전송한다.
- 네이버 관계가 맺어지지 않으면, 라우팅 정보를 전송하지 않는다.
- EIGRP는 라우팅 프로세스에 포함된 인터페이스로 헬로라는 패킷을 전송한다. 인접 라우터가 헬로 패킷을 수신하면 패킷에 포함된 정보 중에서 AS번호, 인터페이스의 서브넷 마스크 길이, 암호 및 'K'상수 값이
- 자신과 동일하면 바로 헬로를 보낸 라우터를 네이버로 간주하고, 자신의 라우팅 정보를 전송한다.
- k 상수는 EIGRP가 메트릭 밧을 계산할 떄 사용하는 미리 정해진 값들이다.

- show ip eigrp neighbors
- EIGRP 네이터 테이블 확인

- RIP는 주기적으로 자신의 라우팅 테이블을 전송한다. 이는 라우팅 정보를 광고홤과 동시에 자신이 살아있다는 것을 알리기 위함이다.
- EIGRP는 처음 네이버가 맻어졌을 때만 자신이 알고 있는 네트워크 정보를 모두 전송하고, 네트워크가 변경되면 변경된 정보만 광고한다.
- 정상적인 경우에는 헬로 패킷만 전송하여 자신이 동작 중이라는 것을 알린다.
- EIGRP는 네트워크 종류에 따라 5초 또는 60초마다 헬로 패킷을 전송한다.
- 연속해서 3회 동안 헬로 패킷을 수신하지 못하면 네이버 관계를 해제하며, 이 타이머를 홀드 타임이라고 한다.
- 헬로 패킷의 목적지 주소로 224.0.0.10을 사용한다.


- 메트릭
- 목적지 방향 인터페이스의 대역폭(bandwidth)과 지연(delay)값이다. 
- show interface [f0/0]
- EIGRP는 메트릭을 계산할 때, 각 라우터의 목적지 방향 인터페이스에 설정된 대역폭중 가장 느린 것으로 107으로 나눈다.

             100 usec                20,000usec            100usec
            100,000kbps               1,544kbps          100,000kbps
- R1  <------------------>  R3  <----------------->  R2 
  1.1.13.1          1.1.13.3    1.1.23.3       1.1.23.2  1.1.20.2

- R1에서 R2로 1.1.20.0/24 네트워크의 메트릭을 계산하는 경우
- 목적지 방향 인터페이스 대역폭 중 가장 느린 1,544kbps로 107을 나눈다
- 107/1544 = 6476 ( 소수는 버린다 )
- 지연값은 목적지 방향 인터페이스의 것을 모두 합친 다음 10으로 나눈다.
- (100 + 20000 + 100)/10 = 20200/10 = 2020
- 이렇게 계산한 두 값을 던한 다음 256을 곱하면 EIGRP 메트릭이 된다
- (6476 + 2020)*256 = 2174976


- EIGRP 대역폭 조정
- 위의 예시에서 R2,R3 간에 백업을 위하여 512kbps 속도의 회선을 하나 추가한 경우
- 두 라우터를 연결하는 CUS를 장거리 통신망 회사와 계약한 속도 512kbps로 설정해도 라우터는 이를 인식하지 못한다.
- 라우터는 두 회선의 대역폭을 동일하게 1544kbps로 간주하고 부하분산을 하게 된다 -> 회선을 추가하기 전보다 더 속도가 느리게 된다.

- interface s1/0
- bandwidth 512
- 인터페이스의 대역폭을 실제 속도와 동일하게 설정해주면 된다.
- 인터페이스의 대역폭을 조정할 떄 입력하는 값의 단위는 kbps




- DUAL
- 최적 경로 계산을 위해서 사용하는 알고리즘을 DUAL( Diffusing Update Algorithm )이라고 한다.
   
                        feasible distance
                ----------------------------->
      S1/1                                                 F0/1
     1.1.12.1                                1.1.12.2    1.1.20.2
                                            (successor)
- R1 <---------------------------------------------> R2
   F0/0 1.1.13.1                         S1/2 1.1.23.2
                    ↑            ↑
                    ↓            ↓
                1.1.13.3  R3  S1/2 1.1.23.3
          (feasible successor)  ------------------> 
                                    reported distance

- 피저블 디스턴스 : 현재 루아터에서 특정 목적지 네트워크까지의 최적 메트릭. 다른 라우팅 프로토콜에서 말하는 최적 경로의 메트릭과 동일한 의미
- 석세서 : 최적 경로상의 넥스트 홉 라우터를 의미
- 리포티드 디스턴스 or 에드버타이저드 디스턴스 : 넥스트 홉 라우터에서 목적지 네트워크까지의 메트릭 값
- 피저블 석세서 : 석세서가 아닌 라우터 중에서 FD > RD 라는 조건을 만족하는 넥스트 홉 라우터. FD > RD라는 조건을 피저블 석세스가 되기 위한 조건이라고도 한다. 석세서가 다운되면 피저블 석세서가 석세서 역할을 이어받아 패킷을 전송
- 토폴로지 테이블 : 인접 라우터에게서 수신한 네트워크와 그 네트워크의 메트릭 정보를 저장하는 데이터베이스

- show ip eigrp topology all-links
- eigrp 토폴로지 테이블 확인

- interface [s1/2]
- delay 1999
- 지연값 조정


- 언이퀄 코스트 부하 분산
- 동일한 메트릭 값을 갖는 경로에 대해 부하 분산을 지원한다.
- 다른 IGP에서 지원하지 않는, 매트릭 값이 다른 경로에 대한 부하 분산을 지원하며 이를 언이퀄 코스트 부하 분산이라고 한다.
- 조건
- 피저블 석세서를 통하는 경로이어야 한다. 즉 FD > RD인 경로이어야 한다
- 부하 분산시키고자 하는 경로의 메트릭 밧이 FD*variance 값이내어야 한다. variance 값은 1~128 사이의 값을 사용할 수 있으며, 부바분산 비율이 아니라 부하분산 경로의 범위를 지정하는 역할을 한다

- router eigrp 1
- variance 2
- 언이퀄 코스트 부하분산 설정


- 라우팅 보안
- 라우터 사이의 스위치에 해커 PC가 연결된 경우 와이어샤크 등 패킷 캡쳐 프로그램을 통해 라우터끼리 전송하는 EIGRP 패킷을 볼 수 있고, EIGRP AS 번호 등도 알 수 잇다.
- 해킹 프로그램이나 다이나밉스와 같은 에뮬레이터를 이용하여 PC에서 EIGRP 헬로 패킷을 전송하면 pc와 라우터 간에 네이버가 맺어진다.
- 만약, 라우터가 다른 네트워크 예를 들어 1.1.20.0/24로 가는 패킷을 PC로 전송하게 하거나, 아예 이 네트워크와의 통신이 불통되게 하려면 PC에서 1.1.20.0/25, 1.1.20.128/25와 같이 더 상세한 네트워크 정보를 광고하면 된다.
- 그러면 라우터에서 1.1.20.0/24로 가는 패킷들은 모두 해커의 PC로 라우팅되고, 간단히 내부 네트워크가 해킹당하게 된다.
- 이것을 예방하려면 EIGRP 헬로 패킷을 인증하면 된다.
- 즉, 사전에 양측 라우터에 동일한 암호를 지정하고, 헬로 패킷을 전송할 때 이 암호와 관련된 정보도 같이 보낸다.
- EIGRP 헬로 패킷은 수신한 상대방은 암호 정보가 자신의 것과 같으면 네이버를 맺고, 암호 정보가 없거나 틀리면 네이버를 맺지 않는다.
- 네이버를 맺지 않으면 라우티 정보를 받지 않으므로 결과적으로 해커가 보내는 잘못된 네트워크 정보가 차단된다.

- EIGRP 패킷 인증
- key chain [Mykey]
- 적당한 키 이름을 지정, 대소문자를 구분한다, 키 체인 이름은 네이버와 달라도 된다.

- key [1]
- 1~21억 사이의 적당한 수를 키 번호로 지정, 키 번호는 네이버와 동일해야 한다.

- key-string [cisco]
- 암호를 지정, 네이버와 일치해야 한다.

- exit

- interface [f0/0]
- 네이버와 연결되는 인터페이스 설정 모드, 네이버 간의 인증을 설정

- ip authentication key-chain eigrp 1 [Mykey]
- 만든 키 체인을 적용

- ip authentiaction mode eigrp 1 md5
- 인증 방식을 MD5로 지정, 이 명령을 하기 전에는 EIGRP 패킷 인증이 동작하지 않는다. MD5를 이용하면 실제 암호는 전송되지 않고, 암호를 이용하여 만든 코드만 보내어 보안성이 뛰어난다.

- debug eigrp packets
- EIGRP 패킷 디버깅


- 인터페이스에서 EIGRP 네이버 라우터가 없는 경우. 즉, EIGRP 헬로를 송수신할 필요가 없는 경우

- router eigrp 1
- passive-interface f0/1
- 패시브 인터페이스 설정
- 해당 인터페이스로 EIGRP 헬포 패킷을 전송하지 않을뿐만아니라, 수신하지도 않으므로 네이버가 맺어지지 않는다.