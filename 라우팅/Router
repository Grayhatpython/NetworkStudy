- 라우터
- 라우터는 수신한 패킷의 목적지 네트워크 계층 주소를 참조하여 전송 시키는 장비다.
-   항목            | 스위치                | 라우터
  동작 계층             L2                    L3
    주용도          LAN연결                  WAN연결
패킷 전송 영역      동일 서브넷               다른 서브넷
전송 시 참조 DB     MAC 주소 테이블          라우팅 테이블
DB 생성/유지        트랜스패런트 브리징       라우팅 프로토콜
패킷 루프 방지      STP/RSTP/MSTP           라우팅 프로토콜
전송 치 참조 필드       MAC 주소             IP/IPv6 주소는
브로드캐스트 패킷       플러딩                 차단
멀티캐스트 패킷         플러딩                 차단
목적지를 모를 떄        플러딩                 차단
패킷 처리 속도          빠름                  느림
 
- 라우터를 사용하면 브로드캐스트 영역의 수가 증하고, 각 영역의 크기는 줄어든다.
- 일반적으로 스위치는 LAN이라는 고속 환경에서 사용되므로 프레임의 처리속도가 빠르고, 라우터는 비교적 저속 환경인 WAN에서 사용되므로 패킷 처리속도가 느리다


- 패킷 전송 과정
                 F0/0    F0/1      F/0/     F0/1     F0/0    F0/1
-  PC1    <------>    R1    <------>    R2    <------>    R3   <------>   PC2
 1.1.1.1     1.1.1.2    1.1.2.1  1.1.2.2   1.1.3.1  1.1.3.2  1.1.4.1  1.1.4.2
  0001         0002       0003     0004      0005    0006     0007     0008

- 패킷이 목적지까지 전송되는 도중에 MAC 주소는 라우터를 통과할 때마다 인접한 장비의 MAC 주소로 계속 변경된다. 그러나 IP 주소는 변경되지 않는다.
- 1. PC1에서 PC2로 패킷을 전송하려고 한다. 목적지 IP 주소는 직접 주소를 지정하거나 DNS을 통하여 1.1.4.2라는 것을 알지만 MAC 주소는 모른다.
    따라서 ARP가 필요하다. 목적지 IP 주소 1.1.4.2와 PC1의 IP 주소 1.1.1.1/24가 서브넷이 다르므로 PC1은 게이트웨이 1.1.1.2의 MAC 주소를 찾는 ARP 패킷을 전송한다.
- 2. L2 스위치는 ARP 브로드캐스트 프레임을 R1로 플러딩한다. 이를 수신한 R1은 자신의 MAC 주소 0002를 PC1에게 알려준다. 
    이제, PC1은 출발지 MAC 주소 0001, IP 주소가 1.1.1.1이고 목적지 MAC 주소 0002, IP주소가 1.1.4.2인 패킷을 R1로 전송한다.
- 3. 프레임을 수신한 R1은 목적지 MAC 주소가 자신의 것임을 확인하고, 자신이 처리해야 하는 프레임이라고 판단한다. 역할을 다한 출발지와 목적지 MAC 주소를 제거하고, 목적지 IP가 1.1.4.2임을 확인한다.
    라우팅 테이블을 참조하여 1.1.4.2는 넥스트 홉 IP 주소가 1.1.2.2인 장비로 전송해야 하는 것을 알게된다.
    R1의 ARP 캐시에 1.1.2.2에 대한 정보가 없으면 1.1.2.2의 MAC 주소를 찾는 ARP 패킷을 F0/1 인터페이스로 전송한다. R2에게서 MAC 주소가 0004라는 ARP응답을 수신한다.
    이제, R1은 출발지 MAC 주소가 0003, IP 주소가 1.1.1.1이고 목적지 MAC 주소가 0004, IP 주소가 1.1.4.2인 패킷을 R2로 전송한다.
- 4. 프레임을 수신한 R2는 목적지 MAC 주소가 자신의 것임을 확인하고, 자신이 처리해야 하는 프레임이라고 판단한다.
    출발지와 목적지 MAC 주소를 제거하고, 목적지 IP 주소가 1.1.4.2임을 확인한다. 라우팅 테이블을 참조하여 1.1.4.2는 넥스트 홉 1.1.3.2인 자입로 전송해야 되는것을 알게된다.   
    R2의 ARP 캐시에 1.1.3.2에 대한 정보가 없으면, 1.1.3.2의 MAC 주소를 찾는 ARP 패킷을 F0/1 인터페이스로 전송한다. R3에게서 MAC 주소가 0006이라는 ARP 응답을 수신한다.
    이제, R2는 출발지 MAC 주소 0005, IP 주소가 1.1.1.1이고, 목적지 MAC 주소가 0006, IP 주소가 1.1.4.2인 패킷을 R3로 전송한다.
- 5. 프레임을 수신한 R3은 목적지 MAC 주소가 자신의 것임을 확인하고, 자신이 처리해야 하는 프레임이라고 판단한다.
    출발지와 목적지 MAC 주소를 제거하고, 목적지 IP 주소가 1.1.4.2임을 확인한다. 라우팅 테이블을 참조하여 1.1.4.2는 자신의 F0/1인터페이스에 접속되어 있는 것을 확인한다.
    R3의 ARP 캐시에 1.1.4.2에 대한 정보가 없으면, 1.1.4.2의 MAC 주소를 찾는 ARP 패킷을 F0/1인터페이스로 전송한다.
    PC2에게서 MAC 주소가 0008이라는 ARP 응답을 수신한다. 이제 R3은 출발지 MAC 주소가 0007, IP 주소가 1.1.1.1이고 목적지 MAC 주소가 0008, IP 주소가 1.1.4.2인 패킷을 PC2로 전송한다.
    이런 과정을 거쳐 PC1이 전송한 패킷이 최종 목적지인 PC2에게 도달한다.


- 라우팅 프로토콜의 종류
- 다른 라우터에게 보내는 라우팅 정보의 내용에 따라  디스턴스 백터 라우팅 프로토콜과 링크 상태 라우팅 프로토콜로 분류된다.
- 라우팅 정보에 서브넷 마스크 정보가 없으면 클래스풀 라우팅 프로토콜, 서브넷 마스크 정보가 있으면 클래스리스 라우팅 프로토콜로 분류된다.
- 동일한 조직 내부에서 사용하면 IGP( Interior Gateway Protocol ), 서로 다른 조직 간에 사용하면 EGP( Exterior Gateway Protocol )로 분류된다.
                RIP1 RIP2 EIGRP OSPF IS-IS BGP
- 디스턴스 벡터    O    O     O               O
- 링크 상태                        O    O
- 클래스풀        O
- 클래스리스            O     O    O    O    O
-   IGP          O    O     O    O    O 
-   BGP                                    O


- 디스턴스 벡터 라우팅 프로토콜 
- 라우팅 정보 전송 시 목적지 네트워크와 해당 목적지 네트워크의 메트릭 값을 알려준다.
- 메트릭이란 최적 경로 선택 기준을 말하여 라우팅 프로토콜별로 사용하는 메트릭이 다르다.

- R1    <------->    R2     <------->     R3 
   S1/1       S1/1      S1/2       S1/2        F0/0
 1.1.21.1  1.1.12.2   1.1.23.2   1.1.23.3    1.1.30.3
                                     1.1.30.0/24    네트워크
                                           1        메트릭
                                        1.1.3.3     라우터 ID
                                        1.1.2.2     인접 라우터

- 위의 예시에서 R3이 '목적지 네트워크 1.1.30.0/24에 대해서 나느 메트릭이 1이다'라고 인접 라우터인 R2에게 광고한다.
- 이는 '목적지 주소가 1.1.30.0/24인 패킷을 R3 방향으로 전송하면, R3와 그 네트워크와의 거리는 1이다'라는 의미를 가진다.
- 이 광고를 수신한 R2가 '목적지 네트워크 1.1.30.0/24에 대해서 나는 메트릭이 2이다'라고 인접 라우터인 R1에게 광고한다.
- 이처럼 라우팅 정보에 목적지 네트워크 메트릭과 방향이 포함되므로 디스턴스 벡터 라우팅 프로토콜이라고 한다.
- 디스턴스 벡터 라우팅 프로토콜들은 인접 라우터에게서 광고받은 메트릭 값에 자신의 상황을 반영하여 또 다른 인접 라우터에게 광고한다.
- 디스턴스 벡터 라우팅 프로토콜은 목적지 네트워크가 어느 라우터에 접속되어 있는지 모른다. 오직 어느 방향으로 가면 메트릭 값이 얼마인지만 알고 있다.


- 링크 상태 라우팅 프로토콜
- 라우팅 정보 전송 시 목적지 네트워크와 해당 목적지 네트워크의 메트릭 값, 네트워크가 접속되어 있는 라우터, 그 라우터와 인접한 라우터 등을 광고한다.
- 결과적으로, 링크 상태 라우팅 프로토콜은 다른 라우터들이 전체 네트워크 구성을 파악하기 위하여 필요한 모든 정보를 알려준다.
- 위의 예시에서 R3이 '나의 라우터 ID는 1.1.3.3이고, 나와 인접한 라우터의 라우터 ID는 1.1.2.2입니다. 네트워크 1.1.30.0/24는 나에게 접속되어 있고, 메트릭이 1이다'
- 라고 인접 라우터인 R2에게 광고한다. 이 광고를 수신한 R2가 R1에게 R3에게서 수신한 정보를 그대로 알려준다.
- '나의 라우터 ID는 1.1.3.3이고, 나와 인접한 라우터의 라우터 ID는 1.1.2.2이다. 네트워크 1.1.30.0/24는 나에게 접속되어 있고, 메트릭이 1이다'
- 인접 라우터에게서 광고받은 라우팅 정보를 그대로 인접 라우터에게 알려준다.
- 이 정보들을 이용하여 동일한 에어리어 내부의 네트워크 구성을 모두 파악하게 되고, 특정한 목적지 네트워크로 가는 최적 경로를 계산한다.


- IGP
- 동일한 라우팅 정책이 적용되는 영역을 하나의 AS(Autonomous System)이라고 하며, IANA에서 16비트의 크기 AS 번호를 부여한다.
- AS 번호가 다른 네트워크 간에 사용되는 프로토콜을 EGP라고 하며, 여기에 해당하는 것이 BGP(Border Gateway Protocol)이다
- BGP는 두 개 이상의 접속된 네트워크에서 사용된다.
- 동일 AS 내부에서 사용되는 라우팅 프로토콜 IGP(Interior Gateway Protocol)라고 한다.


- 클래스풀, 클래스리스 라우팅 프로토콜
- 라우팅 정보 전송 시 서브넷 마스크 정보가 없는 라우팅 프로토콜을 클래스풀 라우팅 프로토콜이라고 한다.
- 클래스풀 라우팅 프로토콜은 서브넷 마스크 개념이 없던 시절에 개발된 것들이며 RIP v1과 IGRP가 있다.
- 라우팅 정보 전송 시 서브넷 마스크 정보가 포함되는 라우팅 프로토콜을 클래스리스 라우팅 프로토콜이라고 한다.
- RIP v2, EIGRP, OSPF, IS-IS, BGP 등


- 메트릭
- 라우팅 프로토콜들의 최적 경로 선택 기준을 메트릭이라고 한다.
- 라우팅 프로토콜     |       메트릭
    RIP                    홉 카운트
    EIGRP            대역폭,지연,신뢰도,부하,MTU
    OSPF                   코스트(대역폭)
    IS-IS                   코스트
     BGP                   어트리뷰트

- RIP은 목적지 네트워크까지 거치는 라우터의 수 즉, 홉 카운트를 메트릭으로 사용한다.
- EIGRP는 대역폭이 크고, 지연이 작은 네트워크를 선호한다.
- OSPF와 IS-IS의 메트릭을 코스트라고 하고, 코스트 계산 방식은 서로 다르다.
- OSPF는 대역폭을 이용하고, IS-IS 홉 카운트와 유사한 개념을 사용한다.


- 라우팅 프로토콜간의 우선순위
- 각 라우팅 프로토콜의 우선순위를 수치로 표시한 것을 어드미니스트러티브 디스턴스 (administrative distance) AD라고 한다.
- 하나의 라우터에서 동시에 2가지 이상의 라우팅 프로토콜을 사용하면 AD 값이 낮은 라우팅 프로토콜이 계산한 경로가 라우팅 테이블에 저장된다.

- 라우팅 프로토콜별 AD 값
       경로의 종류             AD
   직접 접속된 네트워크          0
        정적 경로              1
        외부 BGP              20
        내부 EIGRP            90
        OSPF                 110
        IS-IS                115
        RIP                  120
        외부 EIGRP           170
        내부 BGP             200


- 라우팅 테이블
- 라우터가 목적지 네트워크별 출력 인터페이스와 넥스트 홉 IP 주소를 저장해 놓은 데이터베이스
- 라우터는 패킷을 수신하면 목적지 IP 주소를 확인하고, 라우팅 테이블에 지정된 곳으로 전송한다.

- show ip route
- 라우팅 테이블 확인

- D - EIGIP, EX - EIGRP, O - OSPF ....
- 해당 네트워크를 라우팅 테이블에 저장할 때 사용된 라우팅 프로토콜의 종류를 표시한느 코드

- Gateway of last resort is not set
- 디폴트 루트가 설정되지 않았음을 표시,  디폴트 루트란 특정 패킷과 관련된 상세한 네트워크 정보가 라우팅 테이블에 없을 떄 크 패킷을 전송하는 경로

- 1.0.0.0/24 is subnetted, 8 subnets
- 1.0.0.0 네트워크가 24비트 마스크로 서브넷팅이 되어 있으며, 서브넷의 수량은 8개이다.
- 이하의 서브넷팅 된 8개의 서브넷을 표시한다. 서브넷 마스크 길이가 다른 경우에는 맨 마지막 3.0... 으로 시작하는 것과 같다

- R 1.1.1.0[120/1] via 1.1.12.1, 00:00:10, Serial1/0.12
- 목적지 네트워크를 광고받은 라우팅 프로토콜을 표시 즉, 1.1.1.0/24 네트워크를 RIP로 광고받았음을 의미다
- 목적지 네트워크
- 목적지 네트워크 AD 값을 표시
- 목적니 네트워크의 메트릭 값을 표시
- 목적지 네트워크로 가는 넥스트 홉 IP 주소를 표시
- 목적지 네트워크에 대한 라우팅 정보를 최종적으로 수신한 후 경과한 시간을 의미, RIP의 경우 이 시간이 30초보다 크면 라우팅 정보를 수신하지 못했다는 의미다
- 목적지 네트워크로 가는 인터페이스를 표시. 목적지 네트워크로 가는 출구

- C 1.1.2.0 is directly connected, FastEthernet0/0
- C : 현재의 라우터에 직접 접속되어 있는 네트워크임을 표시
- FastEthernet0/0 : 해당 네트워크가 설정되어 있는 인터페이스의 종류 및 번호를 표시


- R 1.1.3.0 [120/1] via 1.1.23.3 00:00:08, Serial1/0.23
        [120/1] via 1.1.32.3, 00:00:08, Serial1/0.32
- 하나의 목적지 네트워크에 대해서 출력 인터페이스(넥스트 홉 IP 주소)가 두 개 이상 설정되어 있으면 해당 네트워크로 가는 경로가 부하 분산된다

- R 2.0.0.0/8[120/1] via 1.1.12.1, 00:00:11, Serial1/0.12
        3.0.0.0/8 is variably subnetted, 2 subnets, 2 masks 
- 3.0.0.0/8로 네트워크는 가변 길이 서브넷 마스킹 되어 있음을 나타낸다.
- 서브넷 마스크의 길이가 다른 서브넷으로 구성되어 있음을 의미한다.
- 서브넷 마스크 길이가 2 종류이며, 서브넷도 2개 임을 나타낸다.



- 롱키스트 매치 룰
- 라우터가 패킷을 라우팅 시킬 때 패킷의 목적지 주소와 라우팅 테이블상의 목적지 네트워크가 일치하는 부분이 가장 긴 곳으로 전송하는데 이것을 롱기스트 매치 룰 이라고 한다.


- 경로 결정 방법
- 복수 개의 라우팅 프로토콜이 설정된 라우터에서 특정 목적지로 가는 경로는 아래 절차에 의해서 결정된다.
- 동일 라우팅 프로토콜 내에서 특정 목적지로 가는 경로가 복수 개 있을 때 '메트릭 값'이 가낭 '낮은' 것이 선택
- 복수 개의 라우팅 프로토콜들이 계산한 특정 네트워크가 라우팅 테이블에 저장될 때는 'AD 값이' 가장 '낮은' 것이 선택 된다.
- 패킷을 전송할 떄 '롱기스트 매치 룰'에 따라 패킷의 목적지 주소와 라우팅 테이블에 있는 네트워크 주소가 가장 길게 일치되는 경로르 선택한다.


- 정적 경로
- 특정 목적지 네트워크로 가는 경로를 네트워크 관리자가 직접 지정한 것
- 목적지 네트워크로 가기 위한 넥스트 홉 IP 주소를 지정한다. 정적 경로만을 이용하여 통신하려면 특정 라우터에 직접 접속되어 있지 않은 모든 네트워크에 대해서 정적 경로를 설정해주어한다.

- 동적 경로
- 라우팅 프로토콜에 의해 특정 목적지 네트워크로 가는 경로가 동적으로 지정된 것

- 루프백 인터페이스
- 논리적인 인터페이스로 여러 가지 설정에서 라우터 ID로 사용되고, 테스트를 위한 추가적인 네트워크를 만들때에도 사용된다. 
- 장비 자신을 의미하는 루프백 주소, CSU 등에서 신호를 되돌려주는 루프백 테스트 등과 같이 사용된다.

- interface loopback 0
- ip address [1.1.1.1] [255.255.255.0]


- 축약을 이용한 정적 경로 설정
- ip route 1.1.0.0 255.255.0.0 1.1.12.2


- 디폴트 루트를 이용한 정적 경로 설정
- 전송하려는 패킷의 목적지 네트워크가 라우팅 테이블에 존재하지 않을 때 그 패킷을 전송하는 곳
- 라우터는 목적지 네트워크가 라우팅 테이블에 없는 패킷들은 모두 차단한다. 디폴트 루트를 설정하면 상세 네트워크를 검색한 후 없으면 모두 디폴트 루트로 전송한다.
- 일반적으로 기업 네트워크에서 인터넷과 연결되는 라우터에는 대부분 디폴트 루트가 설정되어 있다.
- 디폴트 루트는 *표시가 된다.
- 라우팅 기능이 동작하는 L3 장비에서 상요한다.

- no ip routing
- 라우팅 기능 비활성화

- ip default-gateway [1.1.23.2]
- 디폴트 게이트웨이는 라우팅 기능이 지원되지 않는 L2 스위치와 같은 환경에서 디폴트 루트와 같은 역할을 한다.