- RSTP ( Rapid Spanning Tree Protocol )
- 스패닝 트리 프로토콜은 장애 발생 시 대체 경로가 동작하는 시간이 느린다.
- 그래서 IEEE에서 STP를 보완한 RSTP라는 프로토콜을 발표했다.
- STP의 단점인 컨버전스 시간을 획기적으로 단축시킨다.
- 컨버전스 시간이란 네트워크 상태가 변화되었을 때 이것을 반영하여 포트의 역할과 상태가 변경되기까지의 시간을 말한다.

- STP의 컨버전스 시간이 경우에 따라 30초 또는 50초인 반면 RSTP는 토폴로지 변화가 즉시 반영된다.
- RSTP에서 루트 스위치를 선택하고, 루트 포트와 지정 포트가 결정하는 기준은 STP와 동일한다.

- 즉, 브리지 ID가 가장 낮은 스위치가 루트 스위치가 되고, 포트 역할을 결정할 때 BPDU내의 루트 브리지 ID, 경로값, 브리지 ID, 포트 ID를 차례로 비교하여 각 값이 낮은 포트가 루트 포트와 지정 포트로 선택된다.

- 포트 역할을 결정하는 기준은 동일하지만 절차는 완전히 다르다.
- 간접 링크 다운 시 STP에서는 대체 포트가 바로 전송 상태로 변경되지 않고 20초간 기다린다. 이후 다시 30초를 기다렸다가 전송 상태로 변경된다.
- 이렇게 기다리는 이유는 바로 전송 상태로 변경 시 프레임 루프가 발생할 수 있기 떄문이다.

- RSTP에서는 자신의 BPDU 정보가 우세하면 바로 자신이 지정 포트임을 주장하는 제안(proposla) BPDU를 전송한다.
- 이것을 수신한 상대 포트는 이에 동의하여 자신은 루프 포트가 되겠다는 동의(agreement) BPDU를 보내면서 해당 포트를 바로 전송 상태로 변경한다.
- 동의 BPDU를 수신한 지정 포트도 즉시 자신의 포트를 전송 상태로 변경한다.

- RSTP 포트의 역할
- 지정 포트 ( designated port )
- STP의 지정 포트와 동일. 특정 세그먼트에서 루트 스위치 방향으로 데이터 프레임이 전송되는 포트다.
- 스위치 네트워크에서는 세그먼트란 스위치에 의해서 분리되지 않는 구간을 말한다.
- 루트 포트 
- STP의 루트 포트와 동일. 특정 스위치에서 루트 스위치 방향으로 데이터 프레임이 전송되는 유일한 포트. 루트 포트는 스위치당 하나씩 존재
- 대체 포트 ( alternate port )
- 루프 포트가 다운되면 그 역할을 이어받는 포트를 말한다. 데이터 프레임을 송수신하지 않고 차단 상태에 있다.
- 백업 포트 
- 지정 포트가 다운되면 그 역할을 이어받는다. 스위치가 자신이 보낸 BPDU를 다른 포트를 통하여 수신할 때 두 포트 중 후순위의 포트가 백업 포트로 결정된다.
- 동일한 세그먼트에 하나의 스위치에서 두 개 이상의 링크가 접속되어 있을 때 백업 포트가 만들어진다.
- 데이터 프레임을 송수신하지 않고 차단 상태에 있다.
- 비활성 포트
- 역할이 없는 포트. 셧다운된 포트 등

- RSTP 포트 상태
- 폐기, 학습 및 전송 상태로 구분
- 폐기(discarding) 상태는 STP의 차단 상태와 동일. 데이터 프레임을 송수신하지 않으나, BPDU는 수신한다.
- 학습 상태는 STP 학습 상태와 동일. MAC 주소 테이블을 채우기 시작하며, 지정 포트인 경우 BPDU를 전송하기 시작. RSTP의 학습 상태는 아주 짧다
- 전송 상태는 STP 전송 상태와 동일. 데이터 프레임을 스위칭하기 시작한다.


- RSTP 링크 종류
- 포인트 투 포인트 링크 : 풀 두플렉스로 동작하는 포트
- 세어드 링크 : 하프 두플렉스로 동작하는 포트
- 링크 : 상대 장비도 RSTP로 동작하는 스위치와 연결된 포트
- 에지 : PC, 서버 등과 같이 스패닝 트리가 동작하지 않는 종단장치와 연결된 포트
- 피어 : STP와 같이 RSTP가 아닌 프로토콜로 동작하는 스위치와 연결된 포트


- spanning-tree mode rapid-pvst




- MSTP ( Multiple Spanning Tree Protocol )
- STP와 RSTP에서는 하나의 VLAN 당 하나씩 스패닝 트리가 동작한다.
- 1000개의 VLAN이 설정된 스위치 네트워크에서는 2초마다 1000개의 BPDU가 전송되어 스위치에 많은 부하를 준다.
- 이를 해결하기 위해 복수 개의 VLAN을 묶어서 그룹별로 스패닝 트리를 동작시키는 것이 MSTP다.
- 많은 수의 VLAN 사용 시 VLAN 그룹별로 스패닝 트리를 동작시켜 스위치의 부하를 줌임과 동시에 네트워크의 관리를 용이하게 해준다.
- VLAN들을 하나의 인스턴스라는 그룹으로 묶고, 인스턴스 당 하나의 스패닝 트리를 동작시킨다.

- spanning-tree mode mst
- 스패닝 트리 모드를 MST로
- spanning-tree mst configuration
- MSTP 설정 모드로 들어간다.
- name [MyMSTP]
- 적당한 영역 이름을 지정
- instance 1 vlan 10-19
- instance 2 vlan 20-29
- 여러 vlan을 하나의 인스턴스로 묶는다.
- revision 1
- 0 ~ 65535 사이의 적당한 설정 번호를 부여한다. 영역 이름, 인스턴스 매핑 및 설정 번호가 동일하면 하나의 mst 영역으로 동작한다.
